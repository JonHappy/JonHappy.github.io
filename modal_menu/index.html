<!DOCTYPE html>

<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>index</title>
        <script src="js/jquery/external/jquery/jquery.js" type="text/javascript"></script>
        <script src="js/jquery/jquery-ui.js" type="text/javascript"></script>
        <!--<script src="js/jquery/datepicker-ru.js" type="text/javascript"></script>-->
        <!--<link href="js/jquery/jquery-ui.css" rel="stylesheet" type="text/css"/>-->
        <!--<link href="js/jquery/jquery-ui.structure.min.css" rel="stylesheet" type="text/css"/>-->
        <!--<link href="js/jquery/jquery-ui.theme.min.css" rel="stylesheet" type="text/css"/>-->


        <link href="CSS/page.css" rel="stylesheet" type="text/css"/>
        <link rel="icon" type="image/png" href="pic/arrow_ltr2.png" />
    </head>
    <body>

        <table id="tbl1">
            <tr><td class="t1">gggggg</td><td class="t2">gggggg</td></tr>
            <tr><td class="t1">gggggg</td><td class="t2">gggggg</td></tr>
            <tr><td class="t1">gggggg</td><td class="t2">gggggg</td></tr>
            <tr><td class="t1">gggggg</td><td class="t2">gggggg</td></tr>
            <tr><td class="t1">gggggg</td><td class="t2">gggggg</td></tr>
        </table>
        <input id="xx" value="xxxx" type="button">

        <script>
            "use strict";


            $('#tbl1 .t1').hover(
                    function () {
                        $(this).css('background','#ff0000');
                    },
                    function () {
                        $(this).css('background','none');
                    });











            function modal(name, callback_prefix) {
                this.name = name;
                this.callback = callback_prefix + '_' + name + '_';
                this.init();
            }
            modal.prototype = {
                init: function () {
                    $('body').append('<div id="block_screen"></div>');
                    this.block_screen = $('#block_screen');
                    this.main_div = this.name + "_maindiv";
                    $(this.block_screen).css({
                        'width': '100%',
                        'height': '100%',
                        'position': 'absolute',
                        'top': 0,
                        'left': 0,
                        'z-index': 500
                    });
                    var root = block_screen.createShadowRoot();
                    root.appendChild(modd.content.cloneNode(true));
                    var mod = root.getElementById('title_img');
                    $(mod).on('click', {xx: this}, function (ev) {
//                        con.send(ev.data.xx.callback + 'close|555');
                        ev.data.xx.close();
                    });
                },
                close: function (p) {
                    $('#block_screen').remove();
//                    $('#' + this.main_div).remove();
                }
            };

            var mod;

            $('#xx').on('click', function () {
                mod = new modal('mod', 'yyy31');
            });
        </script>
        <template id="modd">
            <style>
                #main{
                    position: relative;
                    top: 300px;
                    left: 500px;
                    background: #ccc;
                    height: 300px;
                    width: 500px;
                    z-index: 600;
                    border-style: groove;
                    box-shadow: 1px 1px 27px 5px rgba(41, 41, 41, 0.22);
                }
                #title{
                    height: 18px;
                    width: 100%;
                    background: #003eff;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    color: white;
                }
                #title img{
                    height: 12px;
                    width: 12px;
                    padding-right: 3px;
                }
                #title span{
                    margin-left: 5px;
                    flex: 1 1 auto;
                }
                #img_box{
                    width: 100%;
                    display: flex;
                    justify-content:flex-start;
                    height: 70px;
                    position: absolute;
                    bottom: 0px;
                    background: #ccffcc;
                }
                #img_add{
                    position: absolute;
                    top: 0px;
                    right: 0px;
                    width: 13px;
                    height: 13px;
                }
                .imggg{
                    padding-right: 5px;
                }
            </style>

            <div id="main">
                <div id="title"><span>Модальное</span>
                    <img id="title_ok" src="pic/tick.png" alt=""/>
                    <img id="title_img" src="pic/del_.png" alt=""/>
                </div>
                <div id="img_box">
                    <img id="img_add" src="pic/add1.png" alt=""/>
                </div>
            </div>
            <script>


                var x = document.getElementById('block_screen').shadowRoot;
                $(x.getElementById('main')).draggable();
                console.log($(x.getElementById('img_add')));
                $(x.getElementById("img_add")).on('click',function (){
                    console.log('999999999');
                    var wo = window.open('\pic.html', '00000');
                });
            </script>
        </template>

        <script>
            function menu(menu_, name, obj_) {
                this.menu = menu_;
                this.name = name;
                this.obj = obj_;
                this.init();
            }
            menu.prototype = {
                init: function () {
                    $('body').append('<div id="block_screen"></div>');
                    this.block_screen = $('#block_screen');
                    this.main_div = this.name + "_maindiv";
                    $(this.block_screen).css({
                        'width': '100%',
                        'height': '100%',
                        'position': 'absolute',
                        'top': 0,
                        'left': 0,
                        'z-index': 500
                    });
                    $(this.block_screen).on('contextmenu', {xx: this}, function (ev) {
                        return false;
                    });
                    $(this.block_screen).on('click', {xx: this}, function (ev) {
                        ev.data.xx.close();
                    });
                    var root = block_screen.createShadowRoot();
                    root.appendChild(this.menu.content.cloneNode(true));


                    var main = root.getElementById('main');
                    var t = $(this.obj).offset().top;
                    var l = $(this.obj).offset().left;
                    $(main).css({
                        'top': (15 + t),
                        'left': (30 + l)
                    });
                    $(root.getElementById('title_img')).on('click', {xx: this}, function (ev) {
//                        con.send(ev.data.xx.callback + 'close|555');
                        ev.data.xx.close();
                    });
                },
                close: function (p) {
                    $('#block_screen').remove();
//                    $('#' + this.main_div).remove();
                }
            };




            var menus;
            $('.t1').on('contextmenu', function () {
                menus = new menu(menu1, 'menus', this);
                return false;
            });


            $('.t2').on('contextmenu', function () {
                menus = new menu(menu2, 'menus', this);
                return false;
            });



        </script>


        <template id="menu1">
            <style>
                #main{
                    position: relative;

                    background: #ccc;
                    height: 80px;
                    width: 80px;
                    z-index: 600;
                    border-style: groove;
                    box-shadow: 1px 1px 27px 5px rgba(41, 41, 41, 0.22);
                }
                #title{
                    height: 18px;
                    width: 100%;
                    background: #003eff;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    color: white;
                }
                #title img{
                    height: 12px;
                    width: 12px;
                    padding-right: 3px;
                }
                #title span{
                    margin-left: 5px;
                }
                table{
                    cursor: pointer;
                }
            </style>
            <div id="main">
                <div id="title"><span>Меню1</span>
                    <img id="title_img" src="pic/del_.png" alt=""/>
                </div>
                <table>
                    <tr><td class="tb1">меню1</td></tr>
                    <tr><td class="tb1">меню2</td></tr>
                    <tr><td class="tb1">меню3</td></tr>
                </table>
            </div>
            <script>
                var w;
                setTimeout(fun, 0);
                function fun() {
                    w = menus;
                    console.log(w);
                }
                var x = document.getElementById('block_screen').shadowRoot;
                var p = x.getElementById('main');
//                $(p).draggable();
                $(p).on('click', function (ev) {
                    ev.stopPropagation();
                });

                $(p).find('.tb1').on('click', function () {
                    $(w.obj).html($(this).html());
                    w.close();
                });
            </script>
        </template>
        <!--На сайте мозиллы говорится что функция createShadowRoot() более не используется. Вместо нее необходимо использовать attachShadow()
        https://developer.mozilla.org/...-->

        <template id="menu2">
            <style>
                #main{
                    position: relative;
                    background: #ccc;
                    /*height: 70px;*/
                    width: 80px;
                    z-index: 600;
                    border-style: groove;
                    box-shadow: 1px 1px 27px 5px rgba(41, 41, 41, 0.22);
                }
                #title{
                    height: 18px;
                    width: 100%;
                    background: #003eff;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    color: white;
                }
                #title img{
                    height: 12px;
                    width: 12px;
                    padding-right: 3px;
                }
                #title span{
                    margin-left: 5px;
                }
                table{
                    cursor: pointer;
                }
            </style>
            <div id="main">
                <div id="title"><span>Меню2</span>
                    <img id="title_img" src="pic/del_.png" alt=""/>
                </div>
                <table>
                    <tr><td class="tb1">пункт1</td></tr>
                    <tr><td class="tb1">пункт2</td></tr>
                    <tr><td class="tb1">пункт3</td></tr>
                </table>
            </div>
            <script>
                var w;
                setTimeout(fun, 0);
                function fun() {
                    w = menus;
                    console.log(w);
                }
                var x = document.getElementById('block_screen').shadowRoot;
                var p = x.getElementById('main');
//                $(p).draggable();
                $(p).on('click', function (ev) {
                    ev.stopPropagation();
                });

                $(p).find('.tb1').on('click', function (event) {
                    event.preventDefault();
                    event.stopPropagation();
                    $(w.obj).html($(this).html());
                    w.close();
                    return false;
                },true);

            </script>
        </template>
    </body>
</html>
